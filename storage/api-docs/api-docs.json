openapi: 3.0.3
info:
  title: Party Planner API
  description: |
    API for managing parties, guests, and items.
    
    Base URL: `http://localhost:8000/api`
    
    Authentication: Use Laravel Sanctum bearer token in Authorization header for protected endpoints.
  version: 1.0.0

servers:
  - url: http://localhost:8000/api
    description: Local development

tags:
  - name: Parties
  - name: Guests
  - name: Items
  - name: User

paths:
  /parties:
    get:
      tags:
        - Parties
      summary: List all parties
      description: Returns all parties with guests and items
      operationId: listParties
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Party'
              example:
                - id: 1
                  host_id: 1
                  name: "New Year's Eve Party"
                  description: "Celebrating the new year"
                  party_date: "2025-12-31T20:00:00.000000Z"
                  location: "123 Main St, City"
                  created_at: "2025-11-05T12:23:31.000000Z"
                  updated_at: "2025-11-05T12:23:31.000000Z"
                  guests:
                    - id: 1
                      user_id: 2
                      party_id: 1
                      status: "pending"
                      created_at: "2025-11-05T12:59:23.000000Z"
                      updated_at: "2025-11-05T12:59:23.000000Z"
                  items:
                    - id: 1
                      party_id: 1
                      name: "Pizza"
                      quantity: 2
                      guest_id: null
                      created_at: "2025-11-05T13:00:30.000000Z"
                      updated_at: "2025-11-05T13:00:30.000000Z"

    post:
      tags:
        - Parties
      summary: Create a new party
      operationId: createParty
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PartyCreate'
            example:
              name: "Birthday Party"
              description: "John's 30th birthday celebration"
              party_date: "2025-12-15T18:00:00"
              location: "456 Oak Avenue, City"
              host_id: 1
      responses:
        '201':
          description: Party created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Party'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /parties/{id}:
    get:
      tags:
        - Parties
      summary: Get party by ID
      description: Returns party with guests (including user details) and items
      operationId: getParty
      parameters:
        - name: id
          in: path
          required: true
          description: Party ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PartyDetail'
        '404':
          description: Party not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Parties
      summary: Update a party
      description: Partial update - only provided fields are updated
      operationId: updateParty
      parameters:
        - name: id
          in: path
          required: true
          description: Party ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PartyUpdate'
            example:
              name: "Updated Party Name"
              location: "New Location"
      responses:
        '200':
          description: Party updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Party'
        '404':
          description: Party not found
        '422':
          description: Validation error

    delete:
      tags:
        - Parties
      summary: Delete a party
      operationId: deleteParty
      parameters:
        - name: id
          in: path
          required: true
          description: Party ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Party deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Party deleted successfully"
        '404':
          description: Party not found

  /guests:
    get:
      tags:
        - Guests
      summary: List all guests
      operationId: listGuests
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GuestDetail'

    post:
      tags:
        - Guests
      summary: Create guest invitation
      description: Creates invitation. Returns existing record if user already invited.
      operationId: createGuest
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GuestCreate'
            example:
              user_id: 2
              party_id: 1
              status: "pending"
      responses:
        '201':
          description: Guest invitation created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Guest'
        '422':
          description: Validation error

  /guests/{id}:
    get:
      tags:
        - Guests
      summary: Get guest by ID
      operationId: getGuest
      parameters:
        - name: id
          in: path
          required: true
          description: Guest ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuestDetail'
        '404':
          description: Guest not found

    put:
      tags:
        - Guests
      summary: Update guest RSVP
      description: Updates guest status only
      operationId: updateGuest
      parameters:
        - name: id
          in: path
          required: true
          description: Guest ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  description: Guest RSVP status
                  example: "confirmed"
            example:
              status: "confirmed"
      responses:
        '200':
          description: Guest updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Guest'
        '404':
          description: Guest not found
        '422':
          description: Validation error

    delete:
      tags:
        - Guests
      summary: Remove guest from party
      operationId: deleteGuest
      parameters:
        - name: id
          in: path
          required: true
          description: Guest ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Guest removed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Guest removed from party"
        '404':
          description: Guest not found

  /items:
    get:
      tags:
        - Items
      summary: List all items
      operationId: listItems
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ItemDetail'

    post:
      tags:
        - Items
      summary: Create item
      description: Optionally assign to guest via guest_id
      operationId: createItem
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ItemCreate'
            example:
              party_id: 1
              name: "Cake"
              quantity: 1
              guest_id: null
      responses:
        '201':
          description: Item created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        '422':
          description: Validation error

  /items/{id}:
    get:
      tags:
        - Items
      summary: Get item by ID
      operationId: getItem
      parameters:
        - name: id
          in: path
          required: true
          description: Item ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ItemDetail'
        '404':
          description: Item not found

    put:
      tags:
        - Items
      summary: Update item
      description: Set guest_id to claim, null to unclaim
      operationId: updateItem
      parameters:
        - name: id
          in: path
          required: true
          description: Item ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ItemUpdate'
            example:
              name: "Chocolate Cake"
              quantity: 2
              guest_id: 1
      responses:
        '200':
          description: Item updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        '404':
          description: Item not found
        '422':
          description: Validation error

    delete:
      tags:
        - Items
      summary: Delete item
      operationId: deleteItem
      parameters:
        - name: id
          in: path
          required: true
          description: Item ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Item deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Item deleted"
        '404':
          description: Item not found

  /user:
    get:
      tags:
        - User
      summary: Get current user
      description: Requires authentication
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Party:
      type: object
      properties:
        id:
          type: integer
          example: 1
        host_id:
          type: integer
          description: ID of the user hosting the party
          example: 1
        name:
          type: string
          example: "New Year's Eve Party"
        description:
          type: string
          nullable: true
          example: "Celebrating the new year"
        party_date:
          type: string
          format: date-time
          example: "2025-12-31T20:00:00.000000Z"
        location:
          type: string
          example: "123 Main St, City"
        created_at:
          type: string
          format: date-time
          example: "2025-11-05T12:23:31.000000Z"
        updated_at:
          type: string
          format: date-time
          example: "2025-11-05T12:23:31.000000Z"
        guests:
          type: array
          items:
            $ref: '#/components/schemas/Guest'
        items:
          type: array
          items:
            $ref: '#/components/schemas/Item'

    PartyDetail:
      allOf:
        - $ref: '#/components/schemas/Party'
        - type: object
          properties:
            guests:
              type: array
              items:
                $ref: '#/components/schemas/GuestDetail'

    PartyCreate:
      type: object
      required:
        - name
        - party_date
        - location
        - host_id
      properties:
        name:
          type: string
          maxLength: 255
          example: "Birthday Party"
        description:
          type: string
          nullable: true
          example: "John's 30th birthday celebration"
        party_date:
          type: string
          format: date-time
          description: Date and time of the party
          example: "2025-12-15T18:00:00"
        location:
          type: string
          example: "456 Oak Avenue, City"
        host_id:
          type: integer
          description: User ID of party host
          example: 1

    PartyUpdate:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
          example: "Updated Party Name"
        description:
          type: string
          nullable: true
          example: "Updated description"
        party_date:
          type: string
          format: date-time
          example: "2025-12-20T19:00:00"
        location:
          type: string
          example: "New Location"
        host_id:
          type: integer
          example: 2

    Guest:
      type: object
      properties:
        id:
          type: integer
          example: 1
        user_id:
          type: integer
          description: ID of the user who is the guest
          example: 2
        party_id:
          type: integer
          description: ID of the party
          example: 1
        status:
          type: string
          description: RSVP status
          example: "pending"
        created_at:
          type: string
          format: date-time
          example: "2025-11-05T12:59:23.000000Z"
        updated_at:
          type: string
          format: date-time
          example: "2025-11-05T12:59:23.000000Z"

    GuestDetail:
      allOf:
        - $ref: '#/components/schemas/Guest'
        - type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
            party:
              $ref: '#/components/schemas/Party'

    GuestCreate:
      type: object
      required:
        - user_id
        - party_id
      properties:
        user_id:
          type: integer
          description: User ID to invite
          example: 2
        party_id:
          type: integer
          description: Party ID
          example: 1
        status:
          type: string
          nullable: true
          description: RSVP status (defaults to 'pending')
          example: "pending"

    Item:
      type: object
      properties:
        id:
          type: integer
          example: 1
        party_id:
          type: integer
          description: Party ID
          example: 1
        name:
          type: string
          example: "Pizza"
        quantity:
          type: integer
          minimum: 1
          default: 1
          example: 2
        guest_id:
          type: integer
          nullable: true
          description: Guest ID (null if unclaimed)
          example: null
        created_at:
          type: string
          format: date-time
          example: "2025-11-05T13:00:30.000000Z"
        updated_at:
          type: string
          format: date-time
          example: "2025-11-05T13:00:30.000000Z"

    ItemDetail:
      allOf:
        - $ref: '#/components/schemas/Item'
        - type: object
          properties:
            guest:
              $ref: '#/components/schemas/Guest'
              nullable: true

    ItemCreate:
      type: object
      required:
        - party_id
        - name
      properties:
        party_id:
          type: integer
          description: Party ID
          example: 1
        name:
          type: string
          maxLength: 255
          example: "Cake"
        quantity:
          type: integer
          minimum: 1
          default: 1
          example: 1
        guest_id:
          type: integer
          nullable: true
          description: Guest ID (optional)
          example: null

    ItemUpdate:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
          example: "Chocolate Cake"
        quantity:
          type: integer
          minimum: 1
          example: 2
        guest_id:
          type: integer
          nullable: true
          description: Guest ID (null to unclaim)
          example: 1

    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john@example.com"
        email_verified_at:
          type: string
          format: date-time
          nullable: true
          example: "2025-11-01T10:00:00.000000Z"
        created_at:
          type: string
          format: date-time
          example: "2025-11-01T10:00:00.000000Z"
        updated_at:
          type: string
          format: date-time
          example: "2025-11-01T10:00:00.000000Z"

    Error:
      type: object
      properties:
        message:
          type: string
          example: "Resource not found"

    ValidationError:
      type: object
      properties:
        message:
          type: string
          example: "The given data was invalid."
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
          example:
            name:
              - "The name field is required."
            party_date:
              - "The party date must be a valid date."

